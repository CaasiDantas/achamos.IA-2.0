<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Compartilhar Localiza√ß√£o</title>
</head>
<body>
  <h2>Compartilhar localiza√ß√£o</h2>

  <input
    type="email"
    id="email"
    placeholder="Digite seu e-mail"
    required
  />
  <br><br>

  <button onclick="iniciar()">Iniciar</button>

  <p id="status"></p>

  <script>
    let watchId = null;

    function iniciar() {
      const email = document.getElementById('email').value;
      if (!email) {
        alert('Digite um e-mail v√°lido');
        return;
      }

      document.getElementById('status').innerText =
        'üì° Compartilhando localiza√ß√£o em tempo real...';

      watchId = navigator.geolocation.watchPosition(
        position => {
          fetch('/api/location', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              email: email,
              lat: position.coords.latitude,
              lng: position.coords.longitude
            })
          });
        },
        error => {
          document.getElementById('status').innerText =
            'Permiss√£o de localiza√ß√£o negada';
        },
        {
          enableHighAccuracy: true,
          maximumAge: 0,
          timeout: 5000
        }
      );
    }
  </script>
</body>
</html>
